<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizApp</title>
    <link rel="stylesheet" href="stylesheet.css">
    <link rel="stylesheet" href="fontawesome-free-6.5.2-web/css/all.css">
</head>

<body>
    <div class="quiz">
        <div class="quiz_header">
            <div class="quiz_header-timer">
                <i class="fa-regular fa-clock"></i>
                <div class="timer_content">
                    <span>Time remaining</span>
                    <p>14:29</p>
                </div>
            </div>
            <button id="quiz_header-btnSubmit">Submit</button>
        </div>

        <div class="quiz_body">
            <div class="content_question">
                <div class="content_question-header">
                    <p>Question 1 of 10</p>
                    <h5>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Repudiandae libero inventore explicabo
                        modi</h5>
                </div>
                <ul>
                    <li><span>A</span><span class="option-item">Living</span></li>
                    <li><span>B</span><span class="option-item">Living</span></li>
                    <li><span>C</span><span class="option-item">Living</span></li>
                    <li><span>D</span><span class="option-item">Living</span></li>
                </ul>
            </div>
            <div class="content_progress">
                <svg>
                    <circle r="70"></circle>
                    <circle id="progress" r="70"></circle>
                </svg>
                <h5>9/10</h5>
            </div>
        </div>

        <div class="quiz_number">
            <button id="btnPrev">Prev</button>
            <ul>

            </ul>
            <button id="btnNext">Next</button>
        </div>

    </div>
    <script>
        // Database
        let questions = [
            {
                quiz_id: 1,
                question:
                    "You can learn a lot about the local _______ by talking to local people.",
                answers: ["territory", "area", "land", "nation"],
            },
            {
                quiz_id: 2,
                question:
                    "It's good to have someone to ________ you when you are visiting a new place.",
                answers: ["lead", "take", "guide", "bring"],
            },
            {
                quiz_id: 3,
                question:
                    "When you ______ your destination, your tour guide will meet you at the airport.",
                answers: ["arrive", "reach", "get", "achieve"],
            },
            {
                quiz_id: 4,
                question: "It can be quite busy here during the tourist ______",
                answers: ["season", "phase", "period", "stage"],
            },
            {
                quiz_id: 5,
                question:
                    "Make sure you _______ a hotel before you come to our island, especially in the summer.",
                answers: ["book", "keep", "put", "buy"],
            },
            {
                quiz_id: 6,
                question: "Captain Cook discovered Australia on a _______ to the Pacific.",
                answers: ["vacation", "travel", "cruise", "voyage"],
            },
            {
                quiz_id: 7,
                question:
                    " Most tourist attractions in London charge an admission ________.",
                answers: ["fare", "ticket", "fee", "pay"],
            },
            {
                quiz_id: 8,
                question: "The hotel where we are _______ is quite luxurious.",
                answers: ["living", "existing", "remaining", "staying"],
            },
            {
                quiz_id: 9,
                question: "Is English an ________ language in your country?",
                answers: ["mother", "official", "living", "old"],
            },
            {
                quiz_id: 10,
                question: "He spoke a ______ of French that we found hard to understand.",
                answers: ["slang", "jargon", "dialect", "language"],
            },


        ];
        const results = [
            {
                quiz_id: 1,
                answer: "area",
            },
            {
                quiz_id: 3,
                answer: "reach",
            },
            {
                quiz_id: 2,
                answer: "guide",
            },
            {
                quiz_id: 4,
                answer: "season",
            },
            {
                quiz_id: 5,
                answer: "book",
            },
            {
                quiz_id: 6,
                answer: "voyage",
            },
            {
                quiz_id: 7,
                answer: "fee",
            },
            {
                quiz_id: 8,
                answer: "staying",
            },
            {
                quiz_id: 9,
                answer: "official",
            },
            {
                quiz_id: 10,
                answer: "dialect",
            },
        ];

        //Get element
        const $ = document.querySelector.bind(document)
        const $$ = document.querySelectorAll.bind(document);

        const timerNumber = $('.timer_content p');
        const submitBtn = $('#quiz_header-btnSubmit')


        const questionNumber = $('.content_question-header p')
        const questionTitle = $('.content_question-header h5')
        const questionList = $('.content_question ul')
        const questionListItem = $$('.content_question ul li')
        const optionItems = $$('.option-item')

        const progress = $('.content_progress svg circle')
        const questionProgress = $('#progress')
        const progressContent = $('.content_progress h5')
        // Lấy tất cả các phần tử <li>
        const quizNumberList = $('.quiz_number ul')
        let quizQuestions = $$('.quiz-number>ul>li')

        const btnNext = $('#btnNext')
        const btnPrev = $('#btnPrev')

        let currentIndex = null
        let listSubmit = []
        let listResult = []
        let isSubmit = false;

        function randomArray(arr) {
            return arr.sort(() => Math.random() - Math.random());
        };

        const quiz = {
            renderTimer(timeInSeconds) {
                updateTimerDisplay(timeInSeconds);

                var countdownInterval = setInterval(function () {
                    timeInSeconds--;

                    updateTimerDisplay(timeInSeconds);
                    if (timeInSeconds == 0) {
                        clearInterval(countdownInterval);
                    }
                    
                }, 1000);
                let outOfTime = false
                // Hàm cập nhật hiển thị của timer
                function updateTimerDisplay(timeInSeconds) {
                    var minutes = Math.floor(timeInSeconds / 60);
                    var seconds = timeInSeconds % 60;
                    // Định dạng hiển thị phút và giây thành chuỗi "mm:ss"
                    var displayString = ('0' + minutes).slice(-2) + ':' + ('0' + seconds).slice(-2);
                    // Gán giá trị của displayString vào phần tử timer
                    timerNumber.textContent = displayString;

                }
            },
            //random question and option
            renderRandomQuestion() {
                questions = randomArray(questions)
                questions.forEach(q => {
                    q.answers = randomArray(q.answers)
                })
            },
            //render list number of question
            renderQuestionListNumber() {
                let render = ''
                questions.forEach((item, index) => {
                    render += `<li>${index + 1}</li>`
                })
                quizNumberList.innerHTML = render
                quizQuestions = $$('.quiz_number ul > li')
            },
            renderQuestionContent() {
                questionNumber.innerText = `Question ${currentIndex + 1} of ${questions.length}`
                questionTitle.innerText = questions[currentIndex].question

                optionItems.forEach((item, index) => {
                    item.innerText = questions[currentIndex].answers[index]
                })
            },
            renderProgress() {
                questionProgress.style = 'stroke-dasharray: 0 9999;'
                progressContent.innerText = `0/${questions.length}`
            },

            renderResult() {
                if (listResult[currentIndex] === listSubmit[currentIndex]) {
                    questionListItem.forEach((item) => {
                        item.classList.remove('incorrect')
                    })
                    questionListItem[listResult[currentIndex]].classList.add('active')

                } else {
                    questionListItem.forEach((item) => {
                        item.classList.remove('active')
                        item.classList.remove('incorrect')
                    })
                    questionListItem[listResult[currentIndex]].classList.add('active')
                    questionListItem[listSubmit[currentIndex]].classList.add('incorrect')
                }
            },
            handleQuestionList() {
                quizQuestions.forEach((item, index) => {
                    item.addEventListener('click', () => {

                        //if the question list number greater than with of quiz app
                        item.scrollIntoView({ behavior: "smooth", block: "center", inline: "nearest" });

                        //remove active has existed before
                        quizQuestions.forEach((item) => item.classList.remove('active'))

                        //add new active class when click on number
                        item.classList.add('active')

                        // Assign current index value                        
                        currentIndex = index

                        //Render question follow question number
                        this.renderQuestionContent()

                        //remove active class for the question has selected yet.
                        questionListItem.forEach(item => item.classList.remove('active'))

                        //Save the active for question has selected
                        const selected = listSubmit[currentIndex]
                        selected >= 0 && questionListItem[selected].click()
                        if (isSubmit) {
                            this.renderResult()
                        }
                    })
                })
                quizQuestions[0].click();
            },
            handleAnswer() {
                questionListItem.forEach((option, index) => {
                    option.addEventListener('click', () => {
                        if (isSubmit) return
                        //remove active class has existed before
                        questionListItem.forEach((item) => item.classList.remove('active'))

                        //add new active class
                        option.classList.add('active')
                        listSubmit[currentIndex] = index

                        //save the question number has selected
                        quizQuestions[currentIndex].classList.add('selected')
                        this.handleProgress()

                    })
                })
            },
            handleProgress() {
                const r = progress.getAttribute('r')
                const progressLength = listSubmit.filter((item) => item >= 0)

                const circlePercent = (2 * Math.PI * r * progressLength.length) / questions.length
                questionProgress.style = `stroke-dasharray: ${circlePercent} 9999;`

                progressContent.innerText = `${progressLength.length}/${questions.length}`

            },

            handlePrev() {
                btnPrev.addEventListener('click', () => {
                    --currentIndex
                    if (currentIndex < 0) {
                        currentIndex = questions.length - 1

                    }
                    quizQuestions.forEach((item) => item.classList.remove('active'))
                    quizQuestions[currentIndex].classList.add('active')
                    this.renderQuestionContent()
                })
            },
            handleNext() {
                btnNext.addEventListener('click', () => {
                    ++currentIndex
                    if (currentIndex > questions.length - 1) {
                        currentIndex = 0
                    }
                    quizQuestions.forEach((item) => item.classList.remove('active'))
                    quizQuestions[currentIndex].classList.add('active')
                    this.renderQuestionContent()
                })
            },
            handleSubmit() {
                submitBtn.addEventListener('click', () => {
                    //Get the submitList lenght 
                    const progressLength = listSubmit.filter((item) => item >= 0)
                    if (progressLength.length === questions.length) {//if answers all the question
                        questions.forEach((item, index) => {
                            //find the answer for each question
                            const result = results.find((r) => r.quiz_id === item.quiz_id)

                            if (questions[index].answers[listSubmit[index]] === result.answer) {//if answer is true
                                listResult[index] = listSubmit[index]//Save these right answers in the new list
                            } else {//if wrong

                                //add class incorrect for the wrong answers
                                quizQuestions[index].classList.add('incorrect');
                                //get the right answer index for wrong answer
                                listResult[index] = item.answers.indexOf(result.answer)
                            }
                        })
                        isSubmit = true;

                    } else {
                        alert('You must answer all question before submit')
                    }
                })

            },
            handle() {
                this.handleQuestionList()
                this.handleAnswer()
                this.handleNext()
                this.handlePrev()
                this.handleSubmit()
            },
            render() {
                this.renderQuestionListNumber()
                this.renderTimer(5)
                this.renderProgress()
            },

            start() {
                this.renderRandomQuestion()
                this.render()
                this.handle()
            }
        }
        quiz.start()

    </script>
</body>

</html>